let v,w;const E=new Map,C=()=>{const e=navigator.userAgent.toLowerCase();return e.includes("mac")?"mac":e.includes("win")?"windows":"other"},L=e=>{const n=e.querySelectorAll(".item");return Array.from(n).map(t=>({element:t,wrapper:t.closest(".launcher-item"),label:t.dataset.label||"",keywords:t.dataset.keywords?.split(",")||[],type:t.dataset.type,href:t.dataset.href,action:t.dataset.action}))},k=e=>L(e).filter(n=>!n.wrapper.hidden),T=(e,n)=>{const t=n.toLowerCase().split(/\s+/),r=[e.label,...e.keywords].join(" ").toLowerCase();return t.every(s=>r.includes(s))},x=(e,n)=>{const t=e.querySelector('[role="status"]');if(!t)return;const r=t.dataset.template||"{count} results available";t.textContent=r.replace("{count}",String(n))},y=(e,n)=>{const t=L(e),r=e.querySelector(".no-results"),s=e.querySelectorAll(".launcher-group"),o=e.querySelector(".end-of-results");let i=0;t.forEach(a=>{const c=!n||T(a,n);a.wrapper.hidden=!c,c&&i++});const u=i>0;s.forEach(a=>{const c=a.querySelectorAll(".launcher-item:not([hidden])");a.hidden=c.length===0}),r&&(r.hidden=u),o&&(o.hidden=!u),n&&x(e,i);const m=k(e);m.length>0?b(e,m[0].element):D(e)},b=(e,n)=>{const t=e.querySelector(".input");e.querySelectorAll('.item[aria-selected="true"]').forEach(r=>{r.setAttribute("aria-selected","false")}),n.setAttribute("aria-selected","true"),n.scrollIntoView({block:"nearest"}),t&&t.setAttribute("aria-activedescendant",n.id)},D=e=>{const n=e.querySelector(".input");e.querySelectorAll('.item[aria-selected="true"]').forEach(t=>{t.setAttribute("aria-selected","false")}),n&&n.setAttribute("aria-activedescendant","")},A=(e,n)=>{const t=k(e);if(t.length===0)return;const r=e.querySelector('.item[aria-selected="true"]'),s=r?t.findIndex(i=>i.element===r):-1;let o;n==="down"?o=s<t.length-1?s+1:0:o=s>0?s-1:t.length-1,b(e,t[o].element)},M=e=>{const n=e.querySelector('.item[aria-selected="true"]');if(!n)return;const t=n.dataset.type,r=n.dataset.href,s=n.dataset.action;t==="navigation"&&r?(f(e),window.location.href=r):t==="action"&&s&&(f(e),document.dispatchEvent(new CustomEvent("launcher:action",{detail:{action:s}})))},I=(e,n)=>{const t=e.querySelector(".input"),r=e.querySelector(".clear");E.set(e,n||null),e.showModal(),document.dispatchEvent(new CustomEvent("launcher:open")),t&&(t.value="",t.focus()),r&&(r.hidden=!0),y(e,""),v=new AbortController,w=new AbortController,document.addEventListener("keydown",s=>{const o=document.activeElement,i=o===t,u=o?.closest(".item");s.key==="ArrowDown"?(s.preventDefault(),A(e,"down")):s.key==="ArrowUp"?(s.preventDefault(),A(e,"up")):s.key==="Enter"&&(i||u)&&(s.preventDefault(),M(e))},{signal:v.signal}),e.addEventListener("click",s=>{s.target===e&&f(e)},{signal:w.signal})},f=e=>{const n=E.get(e);e.close(),n&&n.focus({preventScroll:!0}),E.delete(e),v?.abort(),w?.abort()},B=e=>{const n=e.id,t=document.querySelectorAll(`[data-launcher-target="${n}"]`),r=e.querySelector(".input"),s=e.querySelector(".close"),o=e.querySelector(".clear"),i=C();if(t.length===0){console.warn(`Launcher: No trigger elements found for launcher #${n}`);return}t.forEach(c=>{c.addEventListener("click",()=>I(e,c))}),document.addEventListener("keydown",c=>{if((i==="mac"?c.metaKey:c.ctrlKey)&&c.key.toLowerCase()==="k")if(c.preventDefault(),e.open)f(e);else{const d=Array.from(t).find(p=>{const S=window.getComputedStyle(p);return S.display!=="none"&&S.visibility!=="hidden"});I(e,d)}}),s?.addEventListener("click",()=>f(e)),e.addEventListener("close",()=>{r&&(r.value=""),o&&(o.hidden=!0),y(e,""),v?.abort(),w?.abort()});let u;r?.addEventListener("input",c=>{const h=c.target.value;o&&(o.hidden=!h),clearTimeout(u),u=setTimeout(()=>{y(e,h)},16)}),o?.addEventListener("click",()=>{r&&(r.value="",r.focus(),y(e,""),o.hidden=!0)}),e.addEventListener("click",c=>{const l=c.target.closest(".item");if(l){const d=l.dataset.type,p=l.dataset.action;d==="action"&&p?(f(e),document.dispatchEvent(new CustomEvent("launcher:action",{detail:{action:p}}))):d==="navigation"&&f(e)}});let m=-1,a=-1;e.addEventListener("pointermove",c=>{if(c.clientX===m&&c.clientY===a)return;m=c.clientX,a=c.clientY;const l=c.target.closest(".item"),d=l?.closest(".launcher-item");l&&d&&!d.hidden&&b(e,l)})},q=()=>{document.querySelectorAll(".launcher").forEach(B)};q();document.addEventListener("astro:after-swap",q);
